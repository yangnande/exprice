<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    // 1 promiseçš„å‡ é“åŸºç¡€é¢˜
    // 1.1
    // const promise1 = new Promise((resolve, reject) => {
    //   console.log('promise1')
    // }) // 'promise1'
    // console.log('1', promise1); // '1' Promise{<pending>}
    // 1.2
    // const promise = new Promise((resolve, reject) => {
    //   console.log(1);
    //   resolve('success')
    //   console.log(2);
    // });
    // promise.then(() => {
    //   console.log(3);
    // });
    // console.log(4);
    // 1,2,4,3
    // const promise = new Promise((resolve, reject) => {
    //   console.log(1);
    //   console.log(2);
    // });
    // promise.then(() => {
    //   console.log(3);
    // });
    // console.log(4);
    // å’Œé¢˜ç›®äºŒç›¸ä¼¼ï¼Œåªä¸è¿‡åœ¨promiseä¸­å¹¶æ²¡æœ‰resolveæˆ–è€…reject
    // å› æ­¤promise.thenå¹¶ä¸ä¼šæ‰§è¡Œï¼Œå®ƒåªæœ‰åœ¨è¢«æ”¹å˜äº†çŠ¶æ€ä¹‹åæ‰ä¼šæ‰§è¡Œã€‚
    // ç»“æœï¼š1,2,4
    // 1.4
    // const promise1 = new Promise((resolve, reject) => {
    //   console.log('promise1')
    //   resolve('resolve1')
    // })
    // const promise2 = promise1.then(res => {
    //   console.log(res)
    // })
    // console.log('1', promise1);
    // console.log('2', promise2);
    // 'promise1'
    // '1' Promise{<resolved>: 'resolve1'}
    // '2' Promise{<pending>}
    // 'resolve1'
    // 1.5
    // const fn = () => (new Promise((resolve, reject) => {
    //   console.log(1);
    //   resolve('success')
    // }))
    // fn().then(res => {
    //   console.log(res)
    // })
    // console.log('start')
    // 1,'start','success'
    // 1.6
    // const fn = () =>
    //   new Promise((resolve, reject) => {
    //     console.log(1);
    //     resolve("success");
    //   });
    // console.log("start");
    // fn().then(res => {
    //   console.log(res);
    // });
    // 'start',1,'success'
    // 2. Promiseç»“åˆsetTimeout
    // 2.1
    // console.log('start')
    // setTimeout(() => {
    //   console.log('time')
    // })
    // Promise.resolve().then(() => {
    //   console.log('resolve')
    // })
    // console.log('end')
    // 'start','end','resolve','time'
   
    // const promise = new Promise((resolve, reject) => {
    //   console.log(1);
    //   setTimeout(() => {
    //     console.log("timerStart");
    //     resolve("success");
    //     console.log("timerEnd");
    //   }, 0);
    //   console.log(2);
    // });
    // promise.then((res) => {
    //   console.log(res);
    // });
    // console.log(4);
    // 1,2,4,"timerStart","timerEnd","success"
    // 2.2
    // setTimeout(() => {
    //   console.log('timer1');
    //   setTimeout(() => {
    //     console.log('timer3')
    //   }, 0)
    // }, 0)
    // setTimeout(() => {
    //   console.log('timer2')
    // }, 0)
    // console.log('start')
    // 'start','timer1','timer2','timer3'
   
    // setTimeout(() => {
    //   console.log('timer1');
    //   Promise.resolve().then(() => {
    //     console.log('promise')
    //   })
    // }, 0)
    // setTimeout(() => {
    //   console.log('timer2')
    // }, 0)
    // console.log('start')
    // 'start','timer1','promise','timer2'
    // å¦‚æœæ˜¯å®šæ—¶å™¨timer3çš„è¯ï¼Œå®ƒä¼šåœ¨timer2åæ‰§è¡Œï¼Œè€ŒPromise.thenå´æ˜¯åœ¨timer2ä¹‹å‰æ‰§è¡Œã€‚
    // ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼ŒPromise.thenæ˜¯å¾®ä»»åŠ¡ï¼Œå®ƒä¼šè¢«åŠ å…¥åˆ°æœ¬è½®ä¸­çš„å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œè€Œå®šæ—¶å™¨timer3æ˜¯å®ä»»åŠ¡ï¼Œå®ƒä¼šè¢«åŠ å…¥åˆ°ä¸‹ä¸€è½®çš„å®ä»»åŠ¡ä¸­ã€‚
    // 2.3
    // Promise.resolve().then(() => {
    //   console.log('promise1');
    //   const timer2 = setTimeout(() => {
    //     console.log('timer2')
    //   }, 0)
    // });
    // const timer1 = setTimeout(() => {
    //   console.log('timer1')
    //   Promise.resolve().then(() => {
    //     console.log('promise2')
    //   })
    // }, 0)
    // console.log('start');
    // 'start','promise1','timer1','promise2','timer2'
    // 2.4
    // const promise1 = new Promise((resolve, reject) => {
    //   setTimeout(() => {
    //     resolve('success')
    //   }, 1000)
    // })
    // const promise2 = promise1.then(() => {
    //   throw new Error('error!!!')
    // })
    // console.log('promise1', promise1)
    // console.log('promise2', promise2)
    // setTimeout(() => {
    //   console.log('promise1', promise1)
    //   console.log('promise2', promise2)
    // }, 2000)
    // 'promise1' Promise{<pending>}
    // 'promise2' Promise{<pending>}
    // test5.html:102 Uncaught (in promise) Error: error!!! at test.html:102
    // 'promise1' Promise{<resolved>: "success"}
    // 'promise2' Promise{<rejected>: Error: error!!!}
    // 2.5
    // const promise1 = new Promise((resolve, reject) => {
    //   setTimeout(() => {
    //     resolve("success");
    //     console.log("timer1");
    //   }, 1000);
    //   console.log("promise1é‡Œçš„å†…å®¹");
    // });
    // const promise2 = promise1.then(() => {
    //   throw new Error("error!!!");
    // });
    // console.log("promise1", promise1);
    // console.log("promise2", promise2);
    // setTimeout(() => {
    //   console.log("timer2");
    //   console.log("promise1", promise1);
    //   console.log("promise2", promise2);
    // }, 2000);
    // "promise1é‡Œçš„å†…å®¹"
    // 'promise1' Promise{<pending>}
    // 'promise2' Promise{<pending>}
    // "timer1"
    // Uncaught (in promise) Error: error!!! at promise.html:169
    // "timer2"
    // 'promise1' Promise{<resolved>:"success"}
    // 'promise2' Promise{<rejected>:Error:"error!!!"}
    // 3. Promiseä¸­çš„thenã€catchã€finally
    // 3.1
    // const promise = new Promise((resolve, reject) => {
    //   resolve("success1");
    //   reject("error");
    //   resolve("success2");
    // });
    // promise
    // .then(res => {
    //   console.log("then: ", res);
    // }).catch(err => {
    //   console.log("catch: ", err);
    // })
    // "then: success1"
    // 3.2
    // const promise = new Promise((resolve, reject) => {
    //   reject("error");
    //   resolve("success2");
    // });
    // promise
    //   .then(res => {
    //       console.log("then1: ", res);
    //     }).then(res => {
    //       console.log("then2: ", res);
    //     }).catch(err => {
    //       console.log("catch: ", err);
    //     }).then(res => {
    //       console.log("then3: ", res);
    //     })
    //   "catch: " "error"
    //   "then3: " undefined
    // catchä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚æœªæ•æ‰è¿‡çš„é”™è¯¯ã€‚
    // è‡³äºthen3ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œé‚£æ˜¯å› ä¸ºcatch()ä¹Ÿä¼šè¿”å›ä¸€ä¸ªPromiseï¼Œä¸”ç”±äºè¿™ä¸ªPromiseæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„æ˜¯undefinedã€‚
    // 3.3
    // Promise.resolve(1)
    //   .then(res => {
    //     console.log(res);
    //     return 2; // return 2ä¼šè¢«åŒ…è£…æˆresolve(2)
    //   })
    //   .catch(err => {
    //     return 3;
    //   })
    //   .then(res => {
    //     console.log(res);
    //   });
    //   1
    //   2
    // 3.4
    // Promise.reject(1)
    //   .then(res => {
    //     console.log(res);
    //     return 2;
    //   })
    //   .catch(err => {
    //     console.log(err);
    //     return 3
    //   })
    //   .then(res => {
    //     console.log(res);
    //   });
    // 1
    // 3
    // 3.5
    // const promise = new Promise((resolve, reject) => {
    //   setTimeout(() => {
    //     console.log('timer')
    //     resolve('success')
    //   }, 1000)
    // })
    // const start = Date.now();
    // promise.then(res => {
    //   console.log(res, Date.now() - start)
    // })
    // promise.then(res => {
    //   console.log(res, Date.now() - start)
    // })
    // 'timer'
    // 'success' 
    // 'success'
    // 3.6
    // Promise.resolve().then(() => {
    //   return new Error('error!!!') // ç›¸å½“äºreturn Promise.resolve(new Error('error!!!'));
    //   // throw new Error('error!!!') // return Promise.reject(new Error('error!!!')); ä¸¤ä¸ªä¸€æ ·
    // }).then(res => {
    //   console.log("then: ", res)
    // }).catch(err => {
    //   console.log("catch: ", err)
    // })
    // æŠ›å‡ºé”™è¯¯
    // then:  Error: error!!!
    // catch:  Error: error!!!
    // 3.7
    // const promise = Promise.resolve().then(() => {
    //   return promise;
    // })
    // promise.catch(console.err)
    // .then æˆ– .catch è¿”å›çš„å€¼ä¸èƒ½æ˜¯ promise æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ã€‚
    // Uncaught (in promise) TypeError: Chaining cycle detected for promise #<Promise>
    // 3.8
    // Promise.resolve(1)
    //   .then(2) // æ•°å­—ç±»å‹
    //   .then(Promise.resolve(3)) //å¯¹è±¡ç±»å‹
    //   .then(console.log) // å› æ­¤å‘ç”Ÿäº†é€ä¼ ï¼Œå°†resolve(1) çš„å€¼ç›´æ¥ä¼ åˆ°æœ€åä¸€ä¸ªthené‡Œã€‚
    // .then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼é€ä¼ ã€‚
    // 1
    // 3.9
    // Promise.reject('err!!!')
    //   .then((res) => {
    //     console.log('success', res)
    //   }, (err) => {
    //     console.log('error', err)
    //   }).catch(err => {
    //     console.log('catch', err)
    //   })
    // error err!!!
    // Promise.reject('error!!!')
    //   .then((res) => {
    //     console.log('success', res)
    //   }).catch(err => {
    //     console.log('catch', err)
    //   })
    // catch 'error!!!
    // Promise.resolve()
    //   .then(function success (res) {
    //     throw new Error('error!!!')
    //   }, function fail1 (err) {
    //     console.log('fail1', err)
    //   }).catch(function fail2 (err) {
    //     console.log('fail2', err)
    //   })
    // fail2 error!!! at success (promise.html:310)
    // 3.10
    // .finally()æ–¹æ³•ä¸ç®¡Promiseå¯¹è±¡æœ€åçš„çŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œ
    // .finally()æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨.finally()å‡½æ•°ä¸­æ˜¯æ²¡æ³•çŸ¥é“Promiseæœ€ç»ˆçš„çŠ¶æ€æ˜¯resolvedè¿˜æ˜¯rejectedçš„
    // å®ƒæœ€ç»ˆè¿”å›çš„é»˜è®¤ä¼šæ˜¯ä¸€ä¸ªä¸Šä¸€æ¬¡çš„Promiseå¯¹è±¡å€¼ï¼Œä¸è¿‡å¦‚æœæŠ›å‡ºçš„æ˜¯ä¸€ä¸ªå¼‚å¸¸åˆ™è¿”å›å¼‚å¸¸çš„Promiseå¯¹è±¡ã€‚
    // Promise.resolve('1')
    //   .then(res => {
    //     console.log(res)
    //   })
    //   .finally(() => {
    //     console.log('finally')
    //   })
    // Promise.resolve('2')
    //   .finally(() => {
    //     console.log('finally2')
    //     return 'æˆ‘æ˜¯finally2è¿”å›çš„å€¼'
    //   })
    //   .then(res => {
    //     console.log('finally2åé¢çš„thenå‡½æ•°', res)
    //   })
    // 1
    // finally2
    // finally
    // finally2åé¢çš„thenå‡½æ•° 2
    // Promise.resolve('1')
    //   .finally(() => {
    //     console.log('finally1')
    //     throw new Error('æˆ‘æ˜¯finallyä¸­æŠ›å‡ºçš„å¼‚å¸¸')
    //   })
    //   .then(res => {
    //     console.log('finallyåé¢çš„thenå‡½æ•°', res)
    //   })
    //   .catch(err => {
    //     console.log('æ•è·é”™è¯¯', err)
    //   })
    // 'finally1'
    // æ•è·é”™è¯¯ Error:æˆ‘æ˜¯finallyä¸­æŠ›å‡ºçš„å¼‚å¸¸
    // function promise1 () {
    //   let p = new Promise((resolve) => {
    //     console.log('promise1');
    //     resolve('1')
    //   })
    //   return p;
    // }
    // function promise2 () {
    //   return new Promise((resolve, reject) => {
    //     reject('error')
    //   })
    // }
    // promise1()
    //   .then(res => console.log(res)) // promise1  1
    //   .catch(err => console.log(err))
    //   .finally(() => console.log('finally1')) // finally1

    // promise2()
    //   .then(res => console.log(res))
    //   .catch(err => console.log(err)) // error
    //   .finally(() => console.log('finally2')) // finally2
    // 'promise1'
    // '1'
    // 'error'
    // 'finally1'
    // 'finally2'
    // é“¾å¼è°ƒç”¨åé¢çš„å†…å®¹éœ€è¦ç­‰å‰ä¸€ä¸ªè°ƒç”¨æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œã€‚
    // å°±åƒæ˜¯è¿™é‡Œçš„finally()ä¼šç­‰promise1().then()æ‰§è¡Œå®Œæ‰ä¼šå°†finally()åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå…¶å®å¦‚æœè¿™é“é¢˜ä¸­ä½ æŠŠfinally()æ¢æˆæ˜¯then()ä¹Ÿæ˜¯è¿™æ ·çš„:
    // function promise1 () {
    //   let p = new Promise((resolve) => {
    //     console.log('promise1');
    //     resolve('1')
    //   })
    //   return p;
    // }
    // function promise2 () {
    //   return new Promise((resolve, reject) => {
    //     reject('error')
    //   })
    // }
    // promise1()
    //   .then(res => console.log(res))
    //   .catch(err => console.log(err))
    //   .then(() => console.log('finally1'))

    // promise2()
    //   .then(res => console.log(res))
    //   .catch(err => console.log(err))
    //   .then(() => console.log('finally2'))
    // 'promise1'
    // '1'
    // 'error'
    // 'finally1'
    // 'finally2'
    // æ€»ç»“ï¼š
    // Promiseçš„çŠ¶æ€ä¸€ç»æ”¹å˜å°±ä¸èƒ½å†æ”¹å˜ã€‚(è§3.1)
    // .thenå’Œ.catchéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Promiseã€‚(ä¸Šé¢çš„ğŸ‘†1.4è¯æ˜äº†)
    // catchä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚æœªæ•æ‰è¿‡çš„é”™è¯¯ã€‚(è§3.2)
    // åœ¨Promiseä¸­ï¼Œè¿”å›ä»»æ„ä¸€ä¸ªé promise çš„å€¼éƒ½ä¼šè¢«åŒ…è£¹æˆ promise å¯¹è±¡ï¼Œä¾‹å¦‚return 2ä¼šè¢«åŒ…è£…ä¸ºreturn Promise.resolve(2)ã€‚
    // Promise çš„ .then æˆ–è€… .catch å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡, ä½†å¦‚æœPromiseå†…éƒ¨çš„çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå¹¶ä¸”æœ‰äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåç»­æ¯æ¬¡è°ƒç”¨.thenæˆ–è€….catchçš„æ—¶å€™éƒ½ä¼šç›´æ¥æ‹¿åˆ°è¯¥å€¼ã€‚(è§3.5)
    // .then æˆ–è€… .catch ä¸­ return ä¸€ä¸ª error å¯¹è±¡å¹¶ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åç»­çš„ .catch æ•è·ã€‚(è§3.6)
    // .then æˆ– .catch è¿”å›çš„å€¼ä¸èƒ½æ˜¯ promise æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ã€‚(è§3.7)
    // .then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼é€ä¼ ã€‚(è§3.8)
    // .thenæ–¹æ³•æ˜¯èƒ½æ¥æ”¶ä¸¤ä¸ªå‚æ•°çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤„ç†æˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å¤„ç†å¤±è´¥çš„å‡½æ•°ï¼Œå†æŸäº›æ—¶å€™ä½ å¯ä»¥è®¤ä¸ºcatchæ˜¯.thenç¬¬äºŒä¸ªå‚æ•°çš„ç®€ä¾¿å†™æ³•ã€‚(è§3.9)
    // .finallyæ–¹æ³•ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªPromiseï¼Œä»–åœ¨Promiseç»“æŸçš„æ—¶å€™ï¼Œæ— è®ºç»“æœä¸ºresolvedè¿˜æ˜¯rejectedï¼Œéƒ½ä¼šæ‰§è¡Œé‡Œé¢çš„å›è°ƒå‡½æ•°ã€‚
    // 4. Promiseä¸­çš„allå’Œrace
    // é€šä¿—æ¥è¯´ï¼Œ.all()çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚
    // .race()çš„ä½œç”¨ä¹Ÿæ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåªä¿ç•™å–ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå…¶ä»–çš„æ–¹æ³•ä»åœ¨æ‰§è¡Œï¼Œä¸è¿‡æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒ
    // 4.1 
    // æˆ‘ä»¬çŸ¥é“å¦‚æœç›´æ¥åœ¨è„šæœ¬æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªPromiseï¼Œå®ƒæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼šç«‹å³æ‰§è¡Œçš„ï¼Œå°±åƒè¿™æ ·ï¼š
    // const p1 = new Promise(r => console.log('ç«‹å³æ‰“å°'))
    // å¤åˆ¶ä»£ç æ§åˆ¶å°ä¸­ä¼šç«‹å³æ‰“å°å‡º â€œç«‹å³æ‰“å°â€ã€‚
    // å› æ­¤ä¸ºäº†æ§åˆ¶å®ƒä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£¹ç€å®ƒï¼Œåœ¨éœ€è¦å®ƒæ‰§è¡Œçš„æ—¶å€™ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¯ä»¥äº†ï¼š
    // function runP1 () {
    //     const p1 = new Promise(r => console.log('ç«‹å³æ‰“å°'))
    //     return p1
    // }

    // runP1() // è°ƒç”¨æ­¤å‡½æ•°æ—¶æ‰æ‰§è¡Œ
    // function runAsync (x) {
    //   const p = new Promise(r => setTimeout(() => r(x, console.log(x)), 1000))
    //   return p
    // }
    // runAsync (2)
      // Promise.all([runAsync(1), runAsync(2), runAsync(3)])
      //   .then(res => console.log(res))
        // 1
        // 2
        // 3
        // [1, 2, 3]
        // å¤åˆ¶ä»£ç æ‰€ä»¥ä½ ç°åœ¨èƒ½ç†è§£è¿™å¥è¯çš„æ„æ€äº†å—ï¼šæœ‰äº†allï¼Œä½ å°±å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªå›è°ƒä¸­å¤„ç†æ‰€æœ‰çš„è¿”å›æ•°æ®ã€‚
        // .all()åé¢çš„.then()é‡Œçš„å›è°ƒå‡½æ•°æ¥æ”¶çš„å°±æ˜¯æ‰€æœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚
        // è€Œä¸”è¿™ä¸ªç»“æœä¸­æ•°ç»„çš„é¡ºåºå’ŒPromise.all()æ¥æ”¶åˆ°çš„æ•°ç»„é¡ºåºä¸€è‡´ï¼ï¼ï¼

        // æœ‰ä¸€ä¸ªåœºæ™¯æ˜¯å¾ˆé€‚åˆç”¨è¿™ä¸ªçš„ï¼Œä¸€äº›æ¸¸æˆç±»çš„ç´ ææ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œæ‰“å¼€ç½‘é¡µæ—¶ï¼Œé¢„å…ˆåŠ è½½éœ€è¦ç”¨åˆ°çš„å„ç§èµ„æºå¦‚å›¾ç‰‡ã€flashä»¥åŠå„ç§é™æ€æ–‡ä»¶ã€‚æ‰€æœ‰çš„éƒ½åŠ è½½å®Œåï¼Œæˆ‘ä»¬å†è¿›è¡Œé¡µé¢çš„åˆå§‹åŒ–ã€‚
        // ä¸èƒ½ç†è§£
        // r => setTimeout(() => r(x, console.log(x)), 100)
        // console.log(r(2));
        // function runAsync (x) {
        //     const p = new Promise(r => setTimeout(() => r(x, console.log(x)), 1000))
        //     return p
        // }
        // Promise.all([runAsync(1), runAsync(2), runAsync(3)])
        // .then(res => console.log(res))
      // 4.2 
      // function runAsync (x) {
      //   const p = new Promise(r => setTimeout(() => r(x, console.log(x)), 1000))
      //   return p
      // }
      // function runReject (x) {
      //   const p = new Promise((res, rej) => setTimeout(() => rej(`Error: ${x}`, console.log(x)), 1000 * x))
      //   return p
      // }
      // Promise.all([runAsync(1), runReject(4), runAsync(3), runReject(2)])
      //   .then(res => console.log(res))
      //   .catch(err => console.log(err))
      // // Promise.all([runAsync(1), runReject(4), runAsync(3), runReject(2)])
      // // .then(res => console.log(res), 
      // // err => console.log(err))
      // // 1såè¾“å‡º
      // 1
      // 3
      // // 2såè¾“å‡º
      // 2
      // Error: 2
      // // 4såè¾“å‡º
      // 4.3
      // function runAsync (x) {
      //   const p = new Promise(r => setTimeout(() => r(x, console.log(x)), 1000))
      //   return p
      // }
      // Promise.race([runAsync(1), runAsync(2), runAsync(3)])
      //   .then(res => console.log('result: ', res))
      //   .catch(err => console.log(err))
      // 1
      // 'result: ' 1
      // 2
      // 3
      // 4.4
      // function runAsync(x) {
      //   const p = new Promise(r =>
      //     setTimeout(() => r(x, console.log(x)), 1000)
      //   );
      //   return p;
      // }
      // function runReject(x) {
      //   const p = new Promise((res, rej) =>
      //     setTimeout(() => rej(`Error: ${x}`, console.log(x)), 1000 * x)
      //   );
      //   return p;
      // }
      // Promise.race([runReject(0), runAsync(1), runAsync(2), runAsync(3)])
      //   .then(res => console.log("result: ", res))
      //   .catch(err => console.log(err));
      // 0
      // Error: 0
      // 1
      // 2
      // 3
      // æ€»ç»“
      //   Promise.all()çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚
      //   .race()çš„ä½œç”¨ä¹Ÿæ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåªä¿ç•™å–ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå…¶ä»–çš„æ–¹æ³•ä»åœ¨æ‰§è¡Œï¼Œä¸è¿‡æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒã€‚
      //   Promise.all().then()ç»“æœä¸­æ•°ç»„çš„é¡ºåºå’ŒPromise.all()æ¥æ”¶åˆ°çš„æ•°ç»„é¡ºåºä¸€è‡´ã€‚
      //   allå’Œraceä¼ å…¥çš„æ•°ç»„ä¸­å¦‚æœæœ‰ä¼šæŠ›å‡ºå¼‚å¸¸çš„å¼‚æ­¥ä»»åŠ¡ï¼Œé‚£ä¹ˆåªæœ‰æœ€å…ˆæŠ›å‡ºçš„é”™è¯¯ä¼šè¢«æ•è·ï¼Œå¹¶ä¸”æ˜¯è¢«thençš„ç¬¬äºŒä¸ªå‚æ•°æˆ–è€…åé¢çš„catchæ•è·ï¼›ä½†å¹¶ä¸ä¼šå½±å“æ•°ç»„ä¸­å…¶å®ƒçš„å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œã€‚
      // 5. async/awaitçš„å‡ é“é¢˜
      // async function async1() {
      //   console.log("async1 start");
      //   await async2();
      //   console.log("async1 end");
      // }
      // async function async2() {
      //   console.log("async2");
      // }
      // async1();
      // console.log('start')
      // async1 start
      // async2
      // start
      // async1 end
      // async function async1() {
      //   console.log("async1 start");
      //   // åŸæ¥ä»£ç 
      //   // await async2();
      //   // console.log("async1 end");
        
      //   // è½¬æ¢åä»£ç 
      //   new Promise(resolve => {
      //     console.log("async2")
      //     resolve()
      //   }).then(res => console.log("async1 end"))
      // }
      // async function async2() {
      //   console.log("async2");
      // }
      // async1();
      // console.log("start")
      // async1 start
      // async2
      // "start"
      // async1 end
      // ä¸¤ä¸ªé¢˜çš„ç»“æœä¸€æ ·
      // async function async1() {
      //   console.log("async1 start");
      //   new Promise(resolve => {
      //     console.log('promise')
      //   })
      //   console.log("async1 end");
      // }
      // async1();
      // console.log("start")
      // async1 start
      // promise
      // async1 end
      // start
      // å¯ä»¥çœ‹åˆ°new Promise()å¹¶ä¸ä¼šé˜»å¡åé¢çš„åŒæ­¥ä»£ç async1 endçš„æ‰§è¡Œã€‚
      // 5.2
      // async function async1() {
      //   console.log("async1 start");
      //   await async2();
      //   console.log("async1 end");
      // }
      // async function async2() {
      //   setTimeout(() => {
      //     console.log('timer')
      //   }, 0)
      //   console.log("async2");
      // }
      // async1();
      // console.log("start")
      // async1 start
      // async2
      // start
      // async1 end
      // timer
      // å®šæ—¶å™¨å§‹ç»ˆè¿˜æ˜¯æœ€åæ‰§è¡Œçš„ï¼Œå®ƒè¢«æ”¾åˆ°ä¸‹ä¸€æ¡å®ä»»åŠ¡çš„å»¶è¿Ÿé˜Ÿåˆ—ä¸­ã€‚
      // 5.3
      // async function async1() {
      //   console.log("async1 start");
      //   await async2();
      //   console.log("async1 end");
      //   setTimeout(() => {
      //     console.log('timer1')
      //   }, 0) // w3
      // }
      // async function async2() {
      //   setTimeout(() => {
      //     console.log('timer2')
      //   }, 0) // w1
      //   console.log("async2");
      // }
      // async1();
      // setTimeout(() => {
      //   console.log('timer3')
      // }, 0) // w2
      // console.log("start")
      // async1 start
      // async2
      // start
      // async1 end
      // timer2
      // timer3
      // timer1
      // 5.4
      // æ­£å¸¸æƒ…å†µä¸‹ï¼Œasyncä¸­çš„awaitå‘½ä»¤æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚
      // ä½†å¦‚æœä¸æ˜¯Promiseå¯¹è±¡çš„è¯ï¼Œå°±ä¼šç›´æ¥è¿”å›å¯¹åº”çš„å€¼ï¼Œç›¸å½“äºPromise.resolve()
      // async function fn () {
      //   // return await 1234
      //   // ç­‰åŒäº
      //   return 123 
      // }
      // fn().then(res => console.log(res))
      // 123
      // 5.5
      // async function async1 () {
      //   console.log('async1 start');
      //   await new Promise(resolve => {
      //     console.log('promise1')
      //   })
      //   console.log('async1 success');
      //   return 'async1 end'
      // }
      // console.log('script start')
      // async1().then(res => console.log(res))
      // console.log('script end')
      // åœ¨async1ä¸­awaitåé¢çš„Promiseæ˜¯æ²¡æœ‰è¿”å›å€¼çš„(æ²¡æœ‰ç»™resolveæˆ–rejectçŠ¶æ€)ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„çŠ¶æ€å§‹ç»ˆæ˜¯pendingçŠ¶æ€ï¼Œå› æ­¤ç›¸å½“äºä¸€ç›´åœ¨awaitï¼Œawaitï¼Œawaitå´å§‹ç»ˆæ²¡æœ‰å“åº”...
      // æ‰€ä»¥åœ¨awaitä¹‹åçš„å†…å®¹æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œä¹ŸåŒ…æ‹¬async1åé¢çš„ .thenã€‚
      // 'script start'
      // 'async1 start'
      // 'promise1'
      // 'script end'
      // 5.6
      // async function async1 () {
      //   console.log('async1 start');
      //   await new Promise(resolve => {
      //     console.log('promise1')
      //     resolve('promise1 resolve')
      //   }).then(res => console.log(res)) // w1
      //   console.log('async1 success');
      //   return 'async1 end'
      // }
      // console.log('srcipt start')
      // async1().then(res => console.log(res)) // w2
      // console.log('srcipt end')
      // 'script start'
      // 'async1 start'
      // 'promise1'
      // 'script end'
      // 'promise1 resolve'
      // 'async1 success'
      // 'async1 end'
      // awaitä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œå…ˆåŠ å…¥åˆ°å¾®ä»»åŠ¡ï¼Œè·³å‡ºå‡½æ•° æ‰§è¡Œå®ä»»åŠ¡ï¼Œå®ä»»åŠ¡å®Œæˆå†æ¬¡æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œawaitèµ°å®Œï¼Œåœ¨æ‰§è¡Œåç»­çš„å¾®ä»»åŠ¡
      // 5.7
      // async function async1 () {
      //   console.log('async1 start');
      //   await new Promise(resolve => {
      //     console.log('promise1')
      //     resolve('promise resolve')
      //   })
      //   console.log('async1 success');
      //   return 'async1 end'
      // }
      // console.log('srcipt start')
      // async1().then(res => {
      //   console.log(res)
      // }) // w1
      // new Promise(resolve => {
      //   console.log('promise2')
      //   setTimeout(() => {
      //     console.log('timer')
      //   }) // w2
      // })
      // 'script start'
      // 'async1 start'
      // 'promise1'
      // 'promise2'
      // 'async1 success'
      // 'async1 end'
      // 'timer'
      // 5.8 å¤´æ¡æ›¾ç»çš„é¢è¯•é¢˜
      // async function async1() {
      //   console.log("async1 start");
      //   await async2();
      //   console.log("async1 end");
      // }
      // async function async2() {
      //   console.log("async2");
      // }
      // console.log("script start");
      // setTimeout(function() {
      //   console.log("setTimeout");
      // }, 0); // h1
      // async1();
      // new Promise(function(resolve) {
      //   console.log("promise1");
      //   resolve();
      // }).then(function() {
      //   console.log("promise2");
      // }); // w1
      // console.log('script end')
      // 'script start'
      // 'async1 start'
      // 'async2'
      // 'promise1'
      // 'script end'
      // 'async1 end'
      // 'promise2'
      // 'setTimeout'
      // æ³¨æ„é—®é¢˜
      // 1 await async2() awaitè·³å‡ºå‡½æ•°æ‰§è¡Œasync2()ï¼Œè¦ç»§ç»­æ‰§è¡Œåç»­çš„åŒæ­¥ä»£ç 
      // 2 åŒæ­¥ä»£ç æ‰§è¡Œå®Œï¼Œæ‰§è¡Œç¬¬ä¸€è½®çš„å¾®ä»»åŠ¡'promise2'ï¼Œå¾®ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œåœ¨æ‰§è¡Œå®ä»»åŠ¡åˆ—è¡¨çš„ä»»åŠ¡ï¼ˆsetTimeoutï¼Œå®šæ—¶å™¨ç›¸å…³éƒ½å±äºå®ä»»åŠ¡ï¼‰
      // 5.9
      async function testSometing() {
        console.log("æ‰§è¡ŒtestSometing");
        return "testSometing";  // w1
      }
      async function testAsync() {
        console.log("æ‰§è¡ŒtestAsync");
        return Promise.resolve("hello async"); // w
      }
      async function test() {
        console.log("test start...");
        const v1 = await testSometing(); 
        console.log(v1);
        const v2 = await testAsync();
        console.log(v2);
        console.log(v1, v2);
      }
      test();
      var promise = new Promise(resolve => {
        console.log("promise start...");
        resolve("promise"); 
      });
      promise.then(val => console.log(val)); // w1
      console.log("test end...");
      // "test start..."
      // "æ‰§è¡ŒtestSometing"
      // "testSometing" 'promise start...'
      // "æ‰§è¡ŒtestAsync" 'test end...'
      // PromiseÂ {<resolved>: "hello async"} 'testSometing'
      // "testSometing" "æ‰§è¡ŒtestSometing"
      // PromiseÂ {<resolved>: "hello async"} 'æ‰§è¡ŒtestAsync'
      // "promise start..." 'promise'
      // "test end..." 'hello async'
      // "promise" 'testSometing' 'hello async'
      
      // 'test start...'
      // 'æ‰§è¡ŒtestSometing'
      // 'promise start...'
      // 'test end...'
      // 'testSometing'
      // 'æ‰§è¡ŒtestAsync'
      // 'promise'
      // 'hello async'
      // 'testSometing' 'hello async'

  </script>
</body>
</html>